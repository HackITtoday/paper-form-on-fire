<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../firebase-element/firebase-element.html" />
<link rel="import" href="../paper-datepicker/paper-datepicker.html" />
<link rel="import" href="../paper-input/paper-input.html" />
<link rel="import" href="../paper-button/paper-button.html" />
<link rel="import" href="../paper-toast/paper-toast.html">

<polymer-element name="paper-form-on-fire" attributes="firebase_url_data firebase_url_form link linkText">
  <template id="paper-form-on-fire">
  <template applyAuthorStyles bind if="{{link}}">
    <a href="#!" on-click="{{loadFrom}}" >{{linkText}}</a>
  </template>
  <template bind if="{{!link}}">
    <paper-button on-click="{{loadFrom}}" raised role="button" tabindex="0"> 
      {{linkText}}
    </paper-button>
  </template>
  <paper-action-dialog id="loadFrom" backdrop autoCloseDisabled >

      <firebase-element id="base" location="{{firebase_url_data}}"> </firebase-element>
      <firebase-element id="form" location="{{firebase_url_form}}" data="{{form}}" keys="{{keys}}" dataready> </firebase-element>
      <template repeat="{{x in keys}}">
        <template if="{{form[x].type == 'date'}}">
          <paper-datepicker locale="{{form[x].format}}" formatDate="ll" datePicked="{{data[form[x].id]}}" ></paper-datepicker>
        </template>

        <template if="{{(form[x].type == 'text' || form[x].type == 'email' || form[x].type == 'number' )}}">
          <paper-input-decorator error="{{form[x].error}}" label="{{x|removeLeadingNumber}}" floatinglabel >
          <input value="{{data[form[x].id]}}" is="core-input" type="{{form[x].type}}" id="{{form[x].id}}" {{form[x].required|required}} ></input>
	  </paper-input-decorator>
        </template>
        <template if="{{(form[x].type == 'textarea')}}">
          <paper-input-decorator error="{{form[x].error}}" label="{{x|removeLeadingNumber}}" floatinglabel >
            <textarea value="{{data[form[x].id]}}" is="core-input" type="{{form[x].type}}" id="{{form[x].id}}" ></textarea>
	  </paper-input-decorator>
        </template>
      </template>
      <div horizontal layout>
      </div>
    <paper-button label="CANCEL" affirmative>CANCEL</paper-button>
    <paper-button label="OK" affirmative disabled="{{!$.inputEmail.validity.valid || ($.inputEmail.value == '') }}" on-click="{{addEntry}}">OK</paper-button>
  </paper-action-dialog>
 <paper-toast raised text="Your Message has Been sent" id="toast1" touch-action="none" class="core-transition core-transition-bottom"></paper-toast>
 <paper-toast raised text="Your Message has NOT Been sent PHONE US NOW" id="toast2" touch-action="none" class="core-transition core-transition-bottom"></paper-toast>
 <paper-toast raised text="Please fill in the form" id="toast3" touch-action="none" class="core-transition core-transition-bottom"></paper-toast>
</template>
    <script>
      Polymer('paper-form-on-fire', {

        // initialize the element's model
        ready: function() {
        },
       loadFrom: function(e) {
         this.$.loadFrom.toggle();
       },
       check:function(e) { // needs fixing
	 return (moment(this.dateFrom).isAfter() && $.inputEmail.validity.valid);
       },
       data:{},
       addEntry: function() {
         if (this.check) {
	    if (this.$.base.push(this.data) != false) {
              this.$.toast1.show();// Sent
              this.ready();
            } else {
              this.$.toast2.show();// Not sent
            }
         } else {
           this.$.toast3.show();// Not fill in
           return false;
         }
       },
       removeLeadingNumber: function(str){
         return  str.match(/^[0-9]\s+(.*)$/)[1];
       },
       required:  function(str){
         if (str+""=="1") return "required";
       }
      });
  </script>
  </polymer-element>
</html>
